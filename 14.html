<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โปรแกรมสุ่มตัวเลข (คำนวณเวลาและย้อนกลับ) - แก้ไขแล้ว</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');

        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            width: 100%;
            max-width: 650px;
            transition: padding 0.3s;
            box-sizing: border-box;
        }

        h1 {
            color: #1a237e;
            margin-bottom: 20px;
            font-size: 1.6rem;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 10px;
            background-color: #f9f9f9;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            box-sizing: border-box;
        }
        
        .section-title {
            color: #1a237e;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.2rem;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
            font-size: 0.95rem;
        }

        input[type="text"], select {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            transition: border-color 0.3s;
            font-family: 'Sarabun', sans-serif;
        }
        
        select {
            text-align-last: center;
        }

        input:focus, select:focus {
            border-color: #3f51b5;
            outline: none;
            box-shadow: 0 0 8px rgba(63, 81, 181, 0.3);
        }
        
        input[type=text]::-webkit-inner-spin-button, 
        input[type=text]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        
        .display {
            background: linear-gradient(to bottom, #2c3e50, #4ca1af);
            padding: 20px 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 3px solid #1a237e;
            min-height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .pingpong-ball {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: white; 
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0 3px;
            background: radial-gradient(circle at 30% 30%, #ff9a9e, #fad0c4);
            box-shadow:
                inset 0 4px 6px rgba(0, 0, 0, 0.6),
                inset 0 -4px 8px rgba(255, 255, 255, 0.2),
                inset -4px -4px 6px rgba(0, 0, 0, 0.3),
                inset 4px 4px 6px rgba(255, 255, 255, 0.3),
                0 5px 15px rgba(0, 0, 0, 0.3);
            text-shadow: 
                -1px -1px 1px rgba(0, 0, 0, 0.6),
                1px 1px 1px rgba(255, 255, 255, 0.1);
            transition: transform 0.2s;
        }

        .pingpong-ball:hover {
            transform: scale(1.1);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            flex-grow: 1;
            padding: 14px 16px;
            font-size: 1rem;
            font-family: 'Sarabun', sans-serif;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            min-width: 120px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .run-button { 
            background: linear-gradient(to right, #4CAF50, #2E7D32); 
            color: white; 
        }
        .run-button:hover { 
            background: linear-gradient(to right, #45a049, #1B5E20); 
        }
        .stop-button { 
            background: linear-gradient(to right, #f44336, #c62828); 
            color: white; 
        }
        .stop-button:hover { 
            background: linear-gradient(to right, #e53935, #b71c1c); 
        }
        .calc-button { 
            background: linear-gradient(to right, #2196F3, #1976D2); 
            color: white; 
        }
        .calc-button:hover { 
            background: linear-gradient(to right, #1E88E5, #1565C0); 
        }
        .reset-button { 
            background: linear-gradient(to right, #FF9800, #EF6C00); 
            color: white; 
        }
        .reset-button:hover { 
            background: linear-gradient(to right, #F57C00, #E65100); 
        }
        .home-button {
            background: linear-gradient(to right, #9C27B0, #6A1B9A);
            color: white;
        }
        .home-button:hover {
            background: linear-gradient(to right, #8E24AA, #4A148C);
        }
        button:disabled { 
            background: #cccccc; 
            color: #666666; 
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .time-result {
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(to right, #fdfcfb, #e2d1c3);
            border-radius: 10px;
            border-left: 5px solid #3f51b5;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .time-result h3 {
            margin-top: 0;
            color: #1a237e;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        
        .time-result p {
            margin: 10px 0;
            font-size: 1rem;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .time-result .highlight {
            font-weight: bold;
            color: #d81b60;
            font-size: 1.1rem;
            word-break: break-all;
            text-align: right;
            flex: 1;
            margin-left: 10px;
        }
        
        .reverse-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .reverse-input input {
            padding: 12px;
            font-size: 1rem;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 8px;
            font-family: 'Sarabun', sans-serif;
        }
        
        .reverse-button-container {
            grid-column: 1 / -1;
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        
        footer {
            margin-top: 25px;
            color: #666;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        /* Animation for numbers */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .animated {
            animation: pulse 0.5s ease-in-out;
        }
        
        .reverse-section {
            margin-top: 30px;
        }

        .info-box {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            text-align: left;
            font-size: 0.9rem;
        }
        
        .warning {
            color: #d32f2f;
            font-weight: bold;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .repeat-button {
            margin-top: 15px;
        }
        
        .copy-button {
            background: linear-gradient(to right, #607D8B, #455A64);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: 8px;
            transition: all 0.2s;
        }
        
        .copy-button:hover {
            background: linear-gradient(to right, #546E7A, #37474F);
        }
        
        .seed-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.4rem;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .input-group {
                margin-bottom: 0;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .pingpong-ball {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }
            
            footer {
                flex-direction: column;
                text-align: center;
            }
            
            .time-result p {
                flex-direction: column;
                text-align: left;
            }
            
            .time-result .highlight {
                text-align: left;
                margin-left: 0;
                margin-top: 5px;
            }
            
            .reverse-input {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .section {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.2rem;
            }
            
            .section-title {
                font-size: 1.1rem;
            }
            
            .pingpong-ball {
                width: 35px;
                height: 35px;
                font-size: 1.3rem;
                margin: 2px;
            }
            
            .display {
                padding: 15px 10px;
                min-height: 80px;
            }
            
            button {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            input[type="text"], select {
                padding: 10px;
                font-size: 0.95rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>โปรแกรมสุ่มตัวเลข (คำนวณเวลาและย้อนกลับ) - แก้ไขแล้ว</h1>

        <div class="info-box">
            <strong>การแก้ไข:</strong> 
            <ul>
                <li>ปรับปรุงการส่งผ่านค่า Initial Seed และสถานะของ PRNG เพื่อให้การคำนวณย้อนกลับแม่นยำและสอดคล้องกัน</li>
                <li>แก้ไขปัญหาไม่สามารถใช้งานซ้ำได้หลังจากคำนวณเวลาเสร็จ</li>
                <li>เปิดใช้งานช่องกรอกเลขเริ่มต้นในส่วนคำนวณย้อนกลับ</li>
                <li>เพิ่มฟังก์ชันคัดลอก Initial Seed State</li>
                <li>เพิ่มปุ่มกลับสู่หน้าหลัก</li>
                <li>ปรับปรุงการแสดงผลบนมือถือ</li>
            </ul>
        </div>

        <div class="section">
            <h2 class="section-title">การตั้งค่าการสุ่มตัวเลข</h2>
            
            <div class="input-grid">
                <div class="input-group">
                    <label for="digitSelector">จำนวนหลัก</label>
                    <select id="digitSelector">
                        <option value="2">2 หลัก</option>
                        <option value="3" selected>3 หลัก</option>
                        <option value="4">4 หลัก</option>
                        <option value="5">5 หลัก</option>
                        <option value="6">6 หลัก</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="startNumber">เลขเริ่มต้น</label>
                    <input type="text" id="startNumber" placeholder="เช่น 100" value="422">
                </div>
                <div class="input-group">
                    <label for="stopNumber">เลขเป้าหมาย</label>
                    <input type="text" id="stopNumber" placeholder="เช่น 999" value="075">
                </div>
            </div>

            <div class="warning">หมายเหตุ: ตัวเลขเริ่มต้นและเป้าหมายต้องมีจำนวนหลักเท่ากับที่เลือก</div>
            
            <div class="attempt-info">
                <strong>ข้อมูล:</strong> <span id="digitInfo">สำหรับตัวเลข 3 หลัก มีทั้งหมด 1,000 ตัว (000 ถึง 999)</span>
            </div>

            <div id="displayArea" class="display">
                <div class="pingpong-ball">0</div>
                <div class="pingpong-ball">0</div>
                <div class="pingpong-ball">0</div>
            </div>

            <div class="button-group">
                <button id="runButton" class="run-button">เริ่มสุ่ม</button>
                <button id="stopButton" class="stop-button" disabled>หยุด</button>
                <button id="resetButton" class="reset-button">รีเซ็ต</button>
                <button id="homeButton" class="home-button">กลับสู่หน้าหลัก</button>
            </div>
            
            <div id="timeResult" class="time-result" style="display: none;">
                <h3>ผลการคำนวณเวลา</h3>
                <p>เลขเริ่มต้น: <span id="startNumberResult" class="highlight">000</span></p>
                <p>เลขเป้าหมาย: <span id="stopNumberResult" class="highlight">000</span></p>
                <p>เวลาใช้ทั้งหมด: <span id="timeUsed" class="highlight">0 วินาที</span></p>
                <p>จำนวนครั้งที่สุ่ม: <span id="attemptCount" class="highlight">0</span></p>
                <p>Initial Seed State: 
                    <span class="seed-container">
                        <span id="initialSeedResult" class="highlight">N/A</span>
                        <button id="copySeedButton" class="copy-button">คัดลอก</button>
                    </span>
                </p>
                
                <div class="repeat-button">
                    <button id="repeatButton" class="run-button">ทำการทดสอบอีกครั้ง</button>
                </div>
            </div>
        </div>
        
        <div class="section reverse-section">
            <h2 class="section-title">การคำนวณย้อนกลับ</h2>
            
            <div class="input-grid">
                <div class="input-group">
                    <label for="reverseDigitSelector">จำนวนหลัก</label>
                    <select id="reverseDigitSelector">
                        <option value="2">2 หลัก</option>
                        <option value="3" selected>3 หลัก</option>
                        <option value="4">4 หลัก</option>
                        <option value="5">5 หลัก</option>
                        <option value="6">6 หลัก</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="reverseStartNumber">เลขเริ่มต้น (สำหรับอ้างอิง)</label>
                    <input type="text" id="reverseStartNumber" placeholder="เช่น 100" value="422">
                </div>
                <div class="input-group" style="grid-column: 1 / -1;">
                    <label for="reverseInitialSeedInput">Initial Seed State (a,b,c,d)</label>
                    <input type="text" id="reverseInitialSeedInput" placeholder="ค่า Seed State จากผลลัพธ์">
                </div>
                <div class="input-group">
                    <label for="reverseAttemptsInput">จำนวนครั้งที่สุ่ม</label>
                    <input type="text" id="reverseAttemptsInput" placeholder="เช่น 12">
                </div>
            </div>
            
            <button id="reverseCalculateButton" class="calc-button" style="width: 100%; margin-top: 15px;">คำนวณผลลัพธ์</button>
            
            <div id="reverseResult" class="time-result" style="margin-top: 25px; display: none;">
                <h3>ผลลัพธ์การคำนวณย้อนกลับ</h3>
                <p>Initial Seed State: <span id="reverseSeedResult" class="highlight">0</span></p>
                <p>จำนวนครั้ง: <span id="reverseAttemptsResult" class="highlight">0</span></p>
                <p>ตัวเลขผลลัพธ์: <span id="reverseNumberResult" class="highlight">000</span></p>
            </div>
        </div>
        
        <footer>
            <div>
                &copy; 2025 Juckmanphai. All Rights Reserved.
            </div>
            <button id="footerHomeButton" class="home-button">กลับสู่หน้าหลัก</button>
        </footer>
    </div>

    <script>
        // --- Deterministic PRNG (sfc32) with state export/import ---
        // Modified to return the current state (a, b, c, d)
        function sfc32(a, b, c, d) {
            let state = { a: a | 0, b: b | 0, c: c | 0, d: d | 0 };

            const next = function() {
                let t = (state.a + state.b | 0) + state.d | 0;
                state.d = state.d + 1 | 0;
                state.a = state.b ^ state.b >>> 9;
                state.b = state.c + (state.c << 3) | 0;
                state.c = (state.c << 21 | state.c >>> 11);
                state.c = state.c + t | 0;
                return (t >>> 0) / 4294967296;
            };

            next.getState = () => [state.a, state.b, state.c, state.d];
            next.setState = (newState) => {
                state.a = newState[0] | 0;
                state.b = newState[1] | 0;
                state.c = newState[2] | 0;
                state.d = newState[3] | 0;
            };
            
            return next;
        }

        // Improved seed generation function for large numbers
        // This now generates the initial a, b, c, d array
        function generateInitialSeedState(startNumStr, stopNumStr, timestampStr) {
            const seedString = `${startNumStr}|${stopNumStr}|${timestampStr}`;
            let a = 0x9E3779B9, b = 0x243F6A88, c = 0xB7E15162, d = 0xDEADBEEF;
            
            for (let i = 0; i < seedString.length; i++) {
                const char = seedString.charCodeAt(i);
                a = (a + char) | 0;
                b = (b ^ char) | 0;
                c = (c + (char << 3)) | 0;
                d = (d ^ (char >>> 5)) | 0;
            }
            return [a, b, c, d];
        }

        // Elements for random number section
        const displayArea = document.getElementById('displayArea');
        const digitSelector = document.getElementById('digitSelector');
        const startNumberInput = document.getElementById('startNumber');
        const stopNumberInput = document.getElementById('stopNumber');
        const runButton = document.getElementById('runButton');
        const stopButton = document.getElementById('stopButton');
        const resetButton = document.getElementById('resetButton');
        const homeButton = document.getElementById('homeButton');
        const footerHomeButton = document.getElementById('footerHomeButton');
        const repeatButton = document.getElementById('repeatButton');
        const timeResult = document.getElementById('timeResult');
        const startNumberResult = document.getElementById('startNumberResult');
        const stopNumberResult = document.getElementById('stopNumberResult');
        const timeUsed = document.getElementById('timeUsed');
        const attemptCount = document.getElementById('attemptCount');
        const initialSeedResult = document.getElementById('initialSeedResult');
        const copySeedButton = document.getElementById('copySeedButton');
        const digitInfo = document.getElementById('digitInfo');
        
        // Elements for reverse calculation section
        const reverseDigitSelector = document.getElementById('reverseDigitSelector');
        const reverseStartNumberInput = document.getElementById('reverseStartNumber');
        const reverseInitialSeedInput = document.getElementById('reverseInitialSeedInput');
        const reverseAttemptsInput = document.getElementById('reverseAttemptsInput');
        const reverseCalculateButton = document.getElementById('reverseCalculateButton');
        const reverseResult = document.getElementById('reverseResult');
        const reverseSeedResult = document.getElementById('reverseSeedResult');
        const reverseAttemptsResult = document.getElementById('reverseAttemptsResult');
        const reverseNumberResult = document.getElementById('reverseNumberResult');

        let intervalId = null; 
        let numDigits = 3; 
        let startTime = null;
        let attempts = 0;
        let currentNumber = '';
        let lastTimeUsed = 0;
        let lastAttempts = 0;
        let currentInitialSeedState = []; // Store the initial seed state array
        let randomFunc = null; // The sfc32 function instance

        // ฟังก์ชันสำหรับการเรนเดอร์ลูกปิงปอง
        function renderPingPongBalls(numberString) {
            displayArea.innerHTML = '';
            for (const digit of numberString) {
                const ball = document.createElement('div');
                ball.className = 'pingpong-ball animated';
                ball.textContent = digit;
                displayArea.appendChild(ball);
                
                setTimeout(() => {
                    ball.classList.remove('animated');
                }, 500);
            }
        }

        // ฟังก์ชันสำหรับการสุ่มตัวเลข (ใช้ deterministic PRNG)
        function generateRandomNumber(digits, randFn) {
            const max = Math.pow(10, digits) - 1;
            const randomValue = Math.floor(randFn() * (max + 1)); 
            
            return randomValue.toString().padStart(digits, '0');
        }
        
        // อัพเดทการตั้งค่าจำนวนหลัก
        function updateDigitSettings() {
            numDigits = parseInt(digitSelector.value, 10);
            const placeholderText = '0'.repeat(numDigits);
            const totalNumbers = Math.pow(10, numDigits);
            const formattedTotal = totalNumbers.toLocaleString();

            startNumberInput.placeholder = placeholderText;
            startNumberInput.maxLength = numDigits;
            stopNumberInput.placeholder = placeholderText;
            stopNumberInput.maxLength = numDigits;

            digitInfo.textContent = `สำหรับตัวเลข ${numDigits} หลัก มีทั้งหมด ${formattedTotal} ตัว (${placeholderText} ถึง ${'9'.repeat(numDigits)})`;

            if (!intervalId) {
                renderPingPongBalls(placeholderText);
            }
        }
        
        // จัดรูปแบบเวลาให้อ่านง่าย
        function formatTime(milliseconds) {
            if (milliseconds < 1000) {
                return `${milliseconds} มิลลิวินาที`;
            } else {
                const seconds = (milliseconds / 1000).toFixed(2);
                return `${seconds} วินาที`;
            }
        }
        
        // หยุดการสุ่มและคำนวณเวลา
        function stopRunning() {
            if (!intervalId) return;

            clearInterval(intervalId);
            intervalId = null;

            const endTime = Date.now();
            const timeElapsed = endTime - startTime;
            lastTimeUsed = timeElapsed;
            lastAttempts = attempts;
            
            startNumberResult.textContent = startNumberInput.value.padStart(numDigits, '0') || '0'.repeat(numDigits);
            stopNumberResult.textContent = stopNumberInput.value.padStart(numDigits, '0');
            timeUsed.textContent = formatTime(timeElapsed);
            attemptCount.textContent = attempts.toLocaleString();
            // Display the initial seed state as a string for copy-pasting
            initialSeedResult.textContent = JSON.stringify(currentInitialSeedState); 
            timeResult.style.display = 'block';

            runButton.disabled = false;
            stopButton.disabled = true;
        }

        // ฟังก์ชันรีเซ็ตการตั้งค่า
        function resetSettings() {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }
            
            const placeholderText = '0'.repeat(numDigits);
            renderPingPongBalls(placeholderText);
            
            runButton.disabled = false;
            stopButton.disabled = true;
            timeResult.style.display = 'none';
            
            // ไม่รีเซ็ตค่าที่ผู้ใช้กรอก เพื่อให้สามารถใช้งานซ้ำได้
        }

        // ฟังก์ชันคำนวณย้อนกลับ
        function calculateReverse() {
            const reverseDigits = parseInt(reverseDigitSelector.value, 10);
            const seedStateString = reverseInitialSeedInput.value;
            const attemptsValue = parseInt(reverseAttemptsInput.value);
            
            if (!seedStateString) {
                alert('กรุณากรอก Initial Seed State ที่ใช้ในการสุ่มครั้งนั้นๆ (ในรูปแบบ [a,b,c,d])');
                reverseInitialSeedInput.focus();
                return;
            }

            let parsedSeedState;
            try {
                parsedSeedState = JSON.parse(seedStateString);
                if (!Array.isArray(parsedSeedState) || parsedSeedState.length !== 4) {
                    throw new Error('Seed State ต้องเป็น Array ที่มี 4 ตัวเลข');
                }
            } catch (e) {
                alert('รูปแบบ Initial Seed State ไม่ถูกต้อง. กรุณากรอกเป็น Array ของตัวเลข 4 ตัว เช่น [123,456,789,101]');
                reverseInitialSeedInput.focus();
                return;
            }

            if (isNaN(attemptsValue) || attemptsValue <= 0) {
                alert('กรุณากรอกจำนวนครั้งที่สุ่มเป็นตัวเลขที่มากกว่า 0');
                reverseAttemptsInput.focus();
                return;
            }
            
            // สร้าง PRNG ด้วย seed state ที่ให้มา
            const reverseRandomGenerator = sfc32(...parsedSeedState); 
            
            let calculatedNumber = '';
            for (let i = 0; i < attemptsValue; i++) {
                calculatedNumber = generateRandomNumber(reverseDigits, reverseRandomGenerator);
            }
            
            reverseSeedResult.textContent = seedStateString;
            reverseAttemptsResult.textContent = attemptsValue;
            reverseNumberResult.textContent = calculatedNumber;
            reverseResult.style.display = 'block';
        }

        // ฟังก์ชันคัดลอก Seed State
        function copySeedToClipboard() {
            const seedText = initialSeedResult.textContent;
            if (seedText === 'N/A') return;
            
            navigator.clipboard.writeText(seedText)
                .then(() => {
                    // แสดงการยืนยันว่าคัดลอกแล้ว
                    const originalText = copySeedButton.textContent;
                    copySeedButton.textContent = 'คัดลอกแล้ว!';
                    
                    setTimeout(() => {
                        copySeedButton.textContent = originalText;
                    }, 2000);
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                    alert('ไม่สามารถคัดลอกได้ กรุณาลองอีกครั้ง');
                });
        }
        
        // อีเวนต์เมื่อเปลี่ยนจำนวนหลัก
        digitSelector.addEventListener('change', () => {
            updateDigitSettings();
            timeResult.style.display = 'none';
        });
        
        // อีเวนต์เมื่อเปลี่ยนจำนวนหลักในส่วนคำนวณย้อนกลับ
        reverseDigitSelector.addEventListener('change', () => {
            const reverseDigits = parseInt(reverseDigitSelector.value, 10);
            const placeholderText = '0'.repeat(reverseDigits);
            reverseStartNumberInput.placeholder = placeholderText;
            reverseStartNumberInput.maxLength = reverseDigits;
            reverseResult.style.display = 'none';
        });

        // อีเวนต์เมื่อกดปุ่มเริ่มสุ่ม
        runButton.addEventListener('click', () => {
            if (intervalId) return;
            
            if (!startNumberInput.value) {
                alert('กรุณากรอกเลขเริ่มต้น');
                startNumberInput.focus();
                return;
            }
            
            if (!stopNumberInput.value) {
                alert('กรุณากรอกเลขเป้าหมาย');
                stopNumberInput.focus();
                return;
            }
            
            if (startNumberInput.value.length !== numDigits) {
                alert(`เลขเริ่มต้นต้องมี ${numDigits} หลัก`);
                startNumberInput.focus();
                return;
            }
            
            if (stopNumberInput.value.length !== numDigits) {
                alert(`เลขเป้าหมายต้องมี ${numDigits} หลัก`);
                stopNumberInput.focus();
                return;
            }
            
            if (startNumberInput.value === stopNumberInput.value) {
                alert('เลขเริ่มต้นและเลขเป้าหมายต้องไม่เหมือนกัน');
                return;
            }

            if (isNaN(parseInt(startNumberInput.value)) || isNaN(parseInt(stopNumberInput.value))) {
                alert('เลขเริ่มต้นและเลขเป้าหมายต้องเป็นตัวเลข');
                return;
            }

            attempts = 0;
            startTime = Date.now();
            
            // Generate initial seed state (a, b, c, d array)
            currentInitialSeedState = generateInitialSeedState(
                startNumberInput.value, 
                stopNumberInput.value, 
                startTime.toString()
            );
            
            // Initialize deterministic PRNG with the generated seed state
            randomFunc = sfc32(...currentInitialSeedState);
            
            timeResult.style.display = 'none';
            
            intervalId = setInterval(() => {
                attempts++;
                currentNumber = generateRandomNumber(numDigits, randomFunc);
                renderPingPongBalls(currentNumber);
                
                const paddedStopNumber = stopNumberInput.value.padStart(numDigits, '0');
                if (currentNumber === paddedStopNumber) {
                    stopRunning();
                    alert(`พบตัวเลขเป้าหมาย ${paddedStopNumber} หลังจากสุ่ม ${attempts} ครั้ง`);
                }
                
                const maxAttempts = Math.pow(10, numDigits) * 10;
                if (attempts > maxAttempts) {
                    stopRunning();
                    alert(`สุ่มเกิน ${maxAttempts.toLocaleString()} ครั้งแล้วยังไม่พบตัวเลขเป้าหมาย กรุณาตรวจสอบการตั้งค่า`);
                }
            }, 10); 

            runButton.disabled = true;
            stopButton.disabled = false;
        });

        // อีเวนต์เมื่อกดปุ่มหยุด
        stopButton.addEventListener('click', stopRunning);
        
        // อีเวนต์เมื่อกดปุ่มรีเซ็ต
        resetButton.addEventListener('click', resetSettings);
        
        // อีเวนต์เมื่อกดปุ่มทำการทดสอบอีกครั้ง
        repeatButton.addEventListener('click', () => {
            timeResult.style.display = 'none';
            const placeholderText = '0'.repeat(numDigits);
            renderPingPongBalls(placeholderText);
        });
        
        // อีเวนต์เมื่อกดปุ่มคำนวณย้อนกลับ
        reverseCalculateButton.addEventListener('click', calculateReverse);
        
        // อีเวนต์เมื่อกดปุ่มคัดลอก Seed
        copySeedButton.addEventListener('click', copySeedToClipboard);
        
        // อีเวนต์เมื่อกดปุ่มกลับสู่หน้าหลัก
        homeButton.addEventListener('click', () => {
            window.location.href = 'https://juckmanphai.github.io/4/index.html';
        });
        
        footerHomeButton.addEventListener('click', () => {
            window.location.href = 'https://juckmanphai.github.io/4/index.html';
        });
        
        // อีเวนต์เมื่อกด Enter ในช่องกรอกต่างๆ
        reverseInitialSeedInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                calculateReverse();
            }
        });
        
        reverseAttemptsInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                calculateReverse();
            }
        });

        // อัพเดทการตั้งค่าเมื่อโหลดหน้า
        document.addEventListener('DOMContentLoaded', () => {
            digitSelector.value = "3";
            reverseDigitSelector.value = "3";
            
            updateDigitSettings();
            
            const reverseDigits = parseInt(reverseDigitSelector.value, 10);
            const placeholderText = '0'.repeat(reverseDigits);
            reverseStartNumberInput.placeholder = placeholderText;
            reverseStartNumberInput.maxLength = reverseDigits;
        });
    </script>

</body>
</html>
